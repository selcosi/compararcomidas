<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>SaludCompare — Móvil Simple</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0B63E5">
<link rel="apple-touch-icon" href="icons/icon-192.png">
<style>
:root{--bg:#0b111a;--surface:#0f1724;--line:#1b2a40;--ink:#eef3ff;--muted:#a6b4cc;--brand:#0b63e5;--accent:#19a058;--safe:env(safe-area-inset-bottom)}
*{box-sizing:border-box}html,body{height:100%}body{margin:0;background:#0a1018;color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial}
.container{max-width:480px;margin:0 auto;padding:16px 14px calc(96px + var(--safe))}
.card{background:var(--surface);border:1px solid var(--line);border-radius:16px;padding:16px;margin:12px 0}
h1{font-size:22px;margin:0 0 6px}h2{font-size:18px;margin:0 0 8px}p{margin:8px 0;color:var(--muted)}
.step{display:flex;align-items:center;gap:8px}.step .num{width:28px;height:28px;border-radius:50%;display:grid;place-content:center;background:var(--brand);font-weight:700}
.btn{width:100%;padding:14px 16px;border-radius:14px;border:1px solid #244a82;background:#132a4d;color:#fff;font-size:16px;cursor:pointer}
.btn:active{transform:scale(.99)}.btn.primary{background:var(--brand);border-color:#1d5fe0}.btn.accent{background:var(--accent)}.btn.muted{background:#162a49;border-color:#25436d}
.tiles{display:grid;grid-template-columns:1fr 1fr;gap:8px}.tile{padding:14px;border-radius:14px;background:#0d1830;border:1px solid var(--line);text-align:center;cursor:pointer}.tile.active{outline:2px solid var(--brand)}
.menu{display:grid;gap:10px}.menu .row{display:grid;grid-template-columns:1fr auto;gap:10px;align-items:center;padding:12px;border-radius:14px;background:#0d1626;border:1px solid var(--line)}
.menu h4{margin:0 0 4px;font-size:16px}.menu p{margin:0;color:#b7c7e1}
.tabbar{position:fixed;left:0;right:0;bottom:0;background:#0e1522;border-top:1px solid var(--line);display:grid;grid-template-columns:repeat(5,1fr);gap:6px;padding:8px 10px calc(8px + var(--safe))}
.tab{padding:10px;border-radius:12px;background:#13233e;border:1px solid #203455;color:#cfe1ff;font-size:12px}.tab.active{background:var(--brand);border-color:#1d5fe0;color:#fff}
.hide{display:none!important}table{width:100%;border-collapse:collapse}th,td{border:1px solid var(--line);padding:8px 10px;background:#0f1829;text-align:left}th{background:#122038}
input,select{width:100%;padding:12px;border-radius:12px;border:1px solid var(--line);background:#0b1422;color:#fff;font:inherit}label{display:block;margin:8px 0 4px;font-size:14px}
</style>
</head>
<body>
<div class="container">

<section id="splash" class="card">
  <div class="step"><span class="num">1</span><h1>Bienvenida</h1></div>
  <p>Compara menús y crea una lonchera. Toca <b>Comenzar</b>.</p>
  <button class="btn primary" onclick="go('inicio')">Comenzar</button>
</section>

<section id="inicio" class="card hide">
  <div class="step"><span class="num">2</span><h1>Configura tu objetivo</h1></div>
  <label>¿Para quién?</label>
  <div class="tiles" id="audTiles">
    <div class="tile active" data-v="Niños">Niños</div>
    <div class="tile" data-v="Adolescente">Adolescente</div>
    <div class="tile" data-v="Adulto">Adulto</div>
    <div class="tile" data-v="Familiar">Familiar</div>
  </div>
  <label style="margin-top:10px">Restricciones</label>
  <div class="tiles" id="restTiles">
    <div class="tile active" data-v="Sin lactosa">Sin lactosa</div>
    <div class="tile" data-v="Sin gluten">Sin gluten</div>
    <div class="tile" data-v="Vegetariano">Vegetariano</div>
    <div class="tile" data-v="Ninguna">Ninguna</div>
  </div>
  <label style="margin-top:10px">Calorías objetivo</label>
  <input type="range" id="kcal" min="1000" max="2500" step="50" value="1400" oninput="kOut.textContent=this.value">
  <p><b><span id="kOut">1400</span> kcal/día</b></p>
  <button class="btn primary" onclick="go('comparar')">Ver menús recomendados</button>
</section>

<section id="comparar" class="card hide">
  <div class="step"><span class="num">3</span><h1>Elige 2 menús</h1></div>
  <div class="menu" id="menuList"></div>
  <button id="btnCompare" class="btn accent" onclick="compare()" disabled>Comparar (0)</button>
</section>

<section id="detalle" class="card hide">
  <div class="step"><span class="num">4</span><h1 id="detTitle">Detalle</h1></div>
  <div id="detInfo"></div>
  <hr>
  <div class="tiles">
    <select id="daySel"></select>
    <select id="mealSel"><option>Desayuno</option><option>Almuerzo</option><option>Merienda</option><option>Cena</option></select>
  </div>
  <button class="btn primary" onclick="addToPlan()">Agregar al plan</button>
</section>

<section id="plan" class="card hide">
  <div class="step"><span class="num">5</span><h1>Plan semanal</h1></div>
  <div id="planGrid"></div>
  <button class="btn muted" onclick="clearPlan()">Limpiar plan</button>
  <button class="btn" onclick="go('lista')">Generar lista de compras</button>
</section>

<section id="lista" class="card hide">
  <div class="step"><span class="num">6</span><h1>Lista de compras</h1></div>
  <table id="tbl"></table>
  <button class="btn primary" onclick="window.print()">Imprimir / Guardar PDF</button>
</section>

<section id="perfil" class="card hide">
  <div class="step"><span class="num">7</span><h1>Perfil</h1></div>
  <label>Alergias</label><input id="pfA" placeholder="Lactosa, Gluten">
  <label>Presupuesto semanal (S/)</label><input id="pfP" type="number" value="150">
  <label>Preferencias</label><input id="pfPr" placeholder="Pollo, Pavo, Pescado">
  <button class="btn primary" onclick="savePrefs()">Guardar</button>
</section>

</div>

<nav class="tabbar">
  <button class="tab active" id="t-inicio" onclick="go('inicio')">Inicio</button>
  <button class="tab" id="t-comparar" onclick="go('comparar')">Comparar</button>
  <button class="tab" id="t-detalle" onclick="go('detalle')">Detalle</button>
  <button class="tab" id="t-plan" onclick="go('plan')">Plan</button>
  <button class="tab" id="t-perfil" onclick="go('perfil')">Perfil</button>
</nav>

<script>
if('serviceWorker' in navigator){ window.addEventListener('load',()=>navigator.serviceWorker.register('./sw.js')); }

const MENUS=[
 {id:'A',n:'Arroz con pollo fit',k:450,p:28,az:6,na:480,c:8.5,t:35,ing:[['Pechuga',300,'g'],['Arroz integral',200,'g'],['Espinaca',100,'g']],pas:['Dorar pollo','Hervir arroz','Mezclar con verduras']},
 {id:'B',n:'Tallarines integrales + pollo',k:520,p:26,az:7,na:520,c:7.8,t:30,ing:[['Pasta integral',200,'g'],['Pechuga',250,'g']],pas:['Hervir pasta','Saltear pollo','Unir y servir']},
 {id:'C',n:'Quinoa + ensalada + pechuga',k:430,p:32,az:5,na:420,c:9.2,t:25,ing:[['Quinoa',180,'g'],['Pechuga',250,'g'],['Yogur SL',100,'g']],pas:['Cocinar quinoa','Plancha pechuga','Ensalada y aderezo']}
];

const state={sel:[],last:'A',plan:{}};

function go(v){
  document.querySelectorAll('section').forEach(s=>s.classList.add('hide'));
  document.getElementById(v).classList.remove('hide');
  document.querySelectorAll('.tab').forEach(b=>b.classList.remove('active'));
  const tb=document.querySelector('#t-'+v); if(tb) tb.classList.add('active');
  if(v==='comparar') renderMenus();
  if(v==='detalle') renderDetalle(state.last);
  if(v==='plan') renderPlan();
  if(v==='lista') renderList();
}
go('splash');

// tiles not needed here (we removed radio/checkbox complexity)

function renderMenus(){
  const box=document.getElementById('menuList'); box.innerHTML='';
  MENUS.forEach(m=>{
    const row=document.createElement('div'); row.className='row';
    row.innerHTML=`<div><h4>${m.n}</h4><p>${m.k} kcal • Prot ${m.p} g • S/ ${m.c.toFixed(2)} • ${m.t} min</p></div>
    <div style="display:grid;gap:6px">
      <button class="btn muted" style="width:auto" onclick="toggleSel('${m.id}')">Seleccionar</button>
      <button class="btn primary" style="width:auto" onclick="state.last='${m.id}'; go('detalle')">Detalle</button>
    </div>`;
    box.appendChild(row);
  });
  updateCompareBtn();
}
function toggleSel(id){
  if(state.sel.includes(id)){ state.sel=state.sel.filter(x=>x!==id); }
  else{ if(state.sel.length>=2){ alert('Solo 2 menús a la vez'); return; } state.sel.push(id); }
  updateCompareBtn();
}
function updateCompareBtn(){
  const b=document.getElementById('btnCompare'); b.disabled=state.sel.length!==2; b.textContent=`Comparar (${state.sel.length})`;
}
function compare(){
  const [a,b]=state.sel.map(id=>MENUS.find(m=>m.id===id));
  alert(`${a.n} vs ${b.n}
Calorías: ${a.k} vs ${b.k}
Proteína: ${a.p} vs ${b.p}
Tiempo: ${a.t} vs ${b.t}`);
}

function renderDetalle(id){
  const m=MENUS.find(x=>x.id===id);
  detTitle.textContent=m.n;
  detInfo.innerHTML=`<p><b>${m.k} kcal</b> • Prot ${m.p} g • Azúcares ${m.az} g • Sodio ${m.na} mg</p>
  <h3>Ingredientes</h3><ul>${m.ing.map(i=>`<li>${i[0]} — ${i[1]} ${i[2]}</li>`).join('')}</ul>
  <h3>Pasos</h3><ol>${m.pas.map(p=>`<li>${p}</li>`).join('')}</ol>`;
  const ds=document.getElementById('daySel'); if(!ds.options.length){ ['Lunes','Martes','Miércoles','Jueves','Viernes','Sábado','Domingo'].forEach(d=>ds.add(new Option(d,d))); }
}

function addToPlan(){
  const d=daySel.value||'Lunes'; const meal=mealSel.value||'Almuerzo';
  state.plan[d+':'+meal]=state.last; alert('Agregado al plan'); renderPlan();
}
function renderPlan(){
  const grid=document.getElementById('planGrid'); grid.innerHTML='';
  ['Lunes','Martes','Miércoles','Jueves','Viernes','Sábado','Domingo'].forEach(d=>{
    const card=document.createElement('div'); card.className='card';
    const items=['Desayuno','Almuerzo','Merienda','Cena'].map(meal=>{
      const id=state.plan[d+':'+meal]; const n=id?MENUS.find(x=>x.id===id).n:'—';
      return `<div><b>${meal}:</b> ${n}</div>`;
    }).join('');
    card.innerHTML=`<h2>${d}</h2>${items}`;
    grid.appendChild(card);
  });
}
function clearPlan(){ state.plan={}; renderPlan(); }
function renderList(){
  const map=new Map();
  Object.values(state.plan).forEach(id=>{
    const m=MENUS.find(x=>x.id===id);
    m?.ing.forEach(([n,c,u])=>{ const k=n+'|'+u; map.set(k,(map.get(k)||0)+c); });
  });
  const tbl=document.getElementById('tbl');
  tbl.innerHTML='<tr><th>Ingrediente</th><th>Cantidad</th><th>Unidad</th></tr>';
  if(!map.size){ tbl.innerHTML+='<tr><td colspan="3"><i>Aún no hay elementos</i></td></tr>'; return; }
  for(const [k,tot] of map.entries()){ const [n,u]=k.split('|'); tbl.innerHTML+=`<tr><td>${n}</td><td>${tot}</td><td>${u}</td></tr>`; }
}
</script>
</body>
</html>
