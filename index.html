<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>SaludCompare — Móvil</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0B63E5">
<link rel="apple-touch-icon" href="icons/icon-192.png">
<style>
:root{--ink:#0e1726;--muted:#6f7d93;--bg:#0b111a;--card:#0f1724;--line:#1b2a40;--brand:#0b63e5;--accent:#19a058;--safe:env(safe-area-inset-bottom)}
*{box-sizing:border-box}html,body{height:100%}body{margin:0;background:#0a1018;color:#eaf1ff;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial}
.container{max-width:480px;margin:0 auto;padding:12px 12px 92px}
.card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:14px;margin:10px 0}
h1{font-size:20px;margin:10px 0 6px}h2{font-size:18px;margin:8px 0}h3{font-size:16px;margin:6px 0;color:#cfe1ff}p{margin:6px 0;color:#c6d2e6}
label{font-size:15px}input,select,button{font:inherit}
input,select{width:100%;background:#0b1422;border:1px solid var(--line);color:#eaf1ff;border-radius:12px;padding:12px 14px}
button{background:#152540;border:1px solid #203454;color:#fff;border-radius:14px;padding:12px 16px;cursor:pointer;width:100%}button:active{transform:scale(.99)}
.btn-primary{background:var(--brand);border-color:#1b5dd1}.btn-accent{background:var(--accent);border-color:#0b8a4c}.btn-muted{background:#13233c;border-color:#1a2f4e}
.toolbar{display:flex;flex-wrap:wrap;gap:8px}.toolbar>*{flex:1 1 48%}
.badge{display:inline-block;font-size:12px;background:#0f2038;border:1px solid #1f3357;padding:6px 8px;border-radius:999px;color:#a9c6ff}
.menu-card{display:grid;grid-template-columns:1fr auto;gap:12px;align-items:center;padding:12px;border:1px solid var(--line);border-radius:14px;background:#0d1626;margin:10px 0}
.menu-card h4{margin:0 0 6px;font-size:16px}.menu-card p{margin:0;color:#b7c7e1}
.table{width:100%;border-collapse:collapse}.table th,.table td{border:1px solid var(--line);padding:8px 10px;text-align:left;background:#0f1829}.table th{background:#122038}
.week{display:grid;grid-template-columns:1fr 1fr;gap:8px}.slot{min-height:90px;background:#0e1729;border:1px dashed #2a4166;border-radius:10px;padding:8px;font-size:13px}
.tabbar{position:fixed;left:0;right:0;bottom:0;background:#0e1522;backdrop-filter:blur(8px);border-top:1px solid #1b2a40;display:flex;gap:4px;padding:8px 10px calc(8px + var(--safe))}
.tab{flex:1;display:flex;flex-direction:column;align-items:center;gap:2px;font-size:12px;color:#cbd8ee;background:transparent;border:none}
.tab.active{color:#fff}.hide{display:none!important}
@media(min-width:520px){.container{max-width:640px}.week{grid-template-columns:repeat(4,1fr)}}
</style>
</head>
<body>
<div class="container">
  <section id="v-splash" class="card">
    <h1>SaludCompare</h1>
    <p>Comparador de menús saludables y creador de loncheras — versión móvil.</p>
    <button class="btn-primary" onclick="nav('inicio')">Comenzar</button>
  </section>

  <section id="v-inicio" class="card hide">
    <h2>¿Para quién?</h2>
    <div class="toolbar">
      <label><input type="radio" name="aud" value="Niños" checked> Niños</label>
      <label><input type="radio" name="aud" value="Adolescente"> Adolescente</label>
      <label><input type="radio" name="aud" value="Adulto"> Adulto</label>
      <label><input type="radio" name="aud" value="Familiar"> Familiar</label>
    </div>
    <h3>Restricciones</h3>
    <div class="toolbar">
      <label><input type="checkbox" id="r_gluten"> Sin gluten</label>
      <label><input type="checkbox" id="r_lactosa" checked> Sin lactosa</label>
      <label><input type="checkbox" id="r_veg"> Vegetariano</label>
    </div>
    <h3>Objetivo calórico</h3>
    <input type="range" id="kcal" min="1000" max="2500" step="50" value="1400" oninput="kOut.textContent=this.value">
    <p><span class="badge"><span id="kOut">1400</span> kcal/día</span></p>
    <button class="btn-primary" onclick="nav('comparar')">Ver menús recomendados</button>
  </section>

  <section id="v-comparar" class="card hide">
    <h2>Selecciona 2 menús</h2>
    <div id="menus"></div>
    <button id="btnCompare" class="btn-accent" onclick="compare()" disabled>Comparar (0)</button>
  </section>

  <section id="v-detalle" class="card hide">
    <h2 id="d-titulo">Detalle</h2>
    <div id="d-info"></div>
    <div class="toolbar" style="margin-top:8px">
      <select id="daySel"></select>
      <select id="mealSel">
        <option>Desayuno</option><option>Almuerzo</option><option>Merienda</option><option>Cena</option>
      </select>
    </div>
    <button class="btn-primary" onclick="addToPlan()">Agregar al plan</button>
  </section>

  <section id="v-plan" class="card hide">
    <h2>Plan semanal</h2>
    <div class="week" id="grid"></div>
    <button class="btn-muted" onclick="clearPlan()">Limpiar plan</button>
  </section>

  <section id="v-lista" class="card hide">
    <h2>Lista de compras</h2>
    <table class="table" id="tbl"></table>
  </section>

  <section id="v-perfil" class="card hide">
    <h2>Perfil</h2>
    <label>Alergias</label><input id="pfA" placeholder="Lactosa, Gluten">
    <label style="margin-top:8px">Presupuesto semanal (S/)</label><input id="pfP" type="number" value="150">
    <label style="margin-top:8px">Preferencias</label><input id="pfPr" placeholder="Pollo, Pavo, Pescado">
    <button class="btn-primary" onclick="savePrefs()">Guardar</button>
  </section>
</div>

<nav class="tabbar">
  <button class="tab" id="t-inicio" onclick="nav('inicio')">Inicio</button>
  <button class="tab" id="t-comparar" onclick="nav('comparar')">Comparar</button>
  <button class="tab" id="t-plan" onclick="nav('plan')">Plan</button>
  <button class="tab" id="t-lista" onclick="nav('lista')">Compras</button>
  <button class="tab" id="t-perfil" onclick="nav('perfil')">Perfil</button>
</nav>

<script>
if('serviceWorker' in navigator){ window.addEventListener('load',()=>navigator.serviceWorker.register('./sw.js')); }

const MENUS=[
 {id:'A',n:'Arroz con pollo fit',k:450,p:28,az:6,na:480,c:8.5,t:35,ing:[['Pechuga',300,'g'],['Arroz integral',200,'g'],['Espinaca',100,'g']],pas:['Dorar pollo','Hervir arroz','Mezclar con verduras']},
 {id:'B',n:'Tallarines integrales + pollo',k:520,p:26,az:7,na:520,c:7.8,t:30,ing:[['Pasta integral',200,'g'],['Pechuga',250,'g']],pas:['Hervir pasta','Saltear pollo','Unir y servir']},
 {id:'C',n:'Quinoa + ensalada + pechuga',k:430,p:32,az:5,na:420,c:9.2,t:25,ing:[['Quinoa',180,'g'],['Pechuga',250,'g'],['Yogur SL',100,'g']],pas:['Cocinar quinoa','Plancha pechuga','Ensalada y aderezo']}
];
const state={sel:[],last:'A',plan:{}};

function nav(view){
  document.querySelectorAll('[id^="v-"]').forEach(e=>e.classList.add('hide'));
  document.getElementById('v-'+view).classList.remove('hide');
  document.querySelectorAll('.tab').forEach(b=>b.classList.remove('active'));
  const tb=document.getElementById('t-'+view); if(tb) tb.classList.add('active');
  if(view==='comparar') renderMenus();
  if(view==='detalle') renderDetalle(state.last);
  if(view==='plan') renderPlan();
  if(view==='lista') renderList();
}
nav('inicio');

function renderMenus(){
  const c=document.getElementById('menus'); c.innerHTML='';
  MENUS.forEach(m=>{
    const row=document.createElement('div'); row.className='menu-card';
    row.innerHTML=`<div>
      <h4>${m.n}</h4>
      <p>${m.k} kcal • Prot ${m.p} g • S/ ${m.c.toFixed(2)} • ${m.t} min</p>
      </div>
      <div style="display:flex;gap:6px">
        <label><input type="checkbox" onchange="toggleSel('${m.id}',this.checked)" ${state.sel.includes(m.id)?'checked':''}></label>
        <button class="btn-primary" style="width:auto" onclick="state.last='${m.id}'; nav('detalle')">Detalle</button>
      </div>`;
    c.appendChild(row);
  });
  updateCompareBtn();
}
function toggleSel(id,on){
  if(on){ if(state.sel.length>=2){ alert('Solo 2 menús'); renderMenus(); return; } if(!state.sel.includes(id)) state.sel.push(id); }
  else{ state.sel=state.sel.filter(x=>x!==id); }
  updateCompareBtn();
}
function updateCompareBtn(){
  const b=document.getElementById('btnCompare'); b.disabled=state.sel.length!==2; b.textContent=`Comparar (${state.sel.length})`;
}
function compare(){
  const [a,b]=state.sel.map(id=>MENUS.find(m=>m.id===id));
  alert(`${a.n} vs ${b.n}
Cal: ${a.k} vs ${b.k}
Prot: ${a.p} vs ${b.p}
Tiempo: ${a.t} vs ${b.t}`);
}

function renderDetalle(id){
  const m=MENUS.find(x=>x.id===id);
  document.getElementById('d-titulo').textContent=m.n;
  document.getElementById('d-info').innerHTML=`
    <p>${m.k} kcal • Prot ${m.p} g • Azúcares ${m.az} g • Sodio ${m.na} mg</p>
    <h3>Ingredientes</h3>
    <ul>${m.ing.map(i=>`<li>${i[0]} — ${i[1]} ${i[2]}</li>`).join('')}</ul>
    <h3>Pasos</h3>
    <ol>${m.pas.map(p=>`<li>${p}</li>`).join('')}</ol>`;
  const ds=document.getElementById('daySel');
  if(!ds.options.length){ ['Lunes','Martes','Miércoles','Jueves','Viernes','Sábado','Domingo'].forEach(d=>ds.add(new Option(d,d))); }
}

function addToPlan(){
  const d=document.getElementById('daySel').value||'Lunes';
  const meal=document.getElementById('mealSel').value||'Almuerzo';
  state.plan[d+':'+meal]=state.last;
  alert('Agregado al plan.'); renderPlan();
}
function renderPlan(){
  const g=document.getElementById('grid'); g.innerHTML='';
  ['Lunes','Martes','Miércoles','Jueves','Viernes','Sábado','Domingo'].forEach(d=>{
    const box=document.createElement('div'); box.className='slot';
    const items=['Desayuno','Almuerzo','Merienda','Cena'].map(meal=>{
      const id=state.plan[d+':'+meal]; const n=id?MENUS.find(x=>x.id===id).n:'—';
      return `<div>${meal}: ${n}</div>`;
    }).join('');
    box.innerHTML=`<b>${d}</b><hr>${items}`;
    g.appendChild(box);
  });
}
function clearPlan(){ state.plan={}; renderPlan(); }
function renderList(){
  const map=new Map();
  Object.values(state.plan).forEach(id=>{
    const m=MENUS.find(x=>x.id===id);
    m.ing.forEach(([n,c,u])=>{ const k=n+'|'+u; map.set(k,(map.get(k)||0)+c); });
  });
  const tbl=document.getElementById('tbl'); tbl.innerHTML='<tr><th>Ingrediente</th><th>Cantidad</th><th>Unidad</th></tr>';
  if(!map.size){ tbl.innerHTML+='<tr><td colspan="3"><i>Vacío</i></td></tr>'; return; }
  for(const [k,tot] of map.entries()){ const [n,u]=k.split('|'); tbl.innerHTML+=`<tr><td>${n}</td><td>${tot}</td><td>${u}</td></tr>`; }
}
</script>
</body>
</html>
